<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Confirmation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h1 {
            margin-bottom: .25rem;
        }

        .subtitle {
            color: #444;
            margin-bottom: 1.25rem;
        }

        .table-wrap {
            overflow-x: auto;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            min-width: 520px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        th {
            text-align: left;
        }

        thead th {
            background: #f6f6f6;
        }

        tbody tr:nth-child(even) {
            background: #fafafa;
        }

        .muted {
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Thank you for your submission</h1>
    <p class="subtitle">Your information has been saved.</p>

    <h2>Most recent entries</h2>
    <div class="table-wrap">
        <table id="entriesTable" aria-live="polite">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Title</th>
                    <th>Age</th>
                    <th>Hometown</th>
                </tr>
            </thead>
            <tbody>
                <tr class="muted"><td colspan="5">Loading…</td></tr>
            </tbody>
        </table>
    </div>

    <script>
    async function loadRecent() {
      const tbody = document.querySelector("#entriesTable tbody");
      try {
        const res = await fetch("/api/entries/recent", { headers: { "Accept": "application/json" }});
        if (!res.ok) throw new Error("HTTP " + res.status);
        const rows = await res.json();

        if (!Array.isArray(rows) || rows.length === 0) {
          tbody.innerHTML = '<tr class="muted"><td colspan="5">No entries yet.</td></tr>';
          return;
        }

        tbody.innerHTML = rows.map(r => `
          <tr>
            <td>${r.id}</td>
            <td>${escapeHtml(r.name ?? "")}</td>
            <td>${escapeHtml(r.title ?? "")}</td>
            <td>${r.age ?? ""}</td>
            <td>${escapeHtml(r.hometown ?? "")}</td>
          </tr>
        `).join("");
      } catch (err) {
        console.error("Failed to load recent entries:", err);
        tbody.innerHTML = '<tr class="muted"><td colspan="5">Could not load entries.</td></tr>';
      }
    }

    // Minimal HTML-escape helper to keep things safe
    function escapeHtml(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    loadRecent();
    </script>
</body>
</html>
